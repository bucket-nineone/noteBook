# Vue3 å…¨å®¶æ¡¶



# è·¯ç”± vue-router@4

> vueå‡çº§vue3ä¹‹åï¼Œé…å¥—çš„vue-routerä¹Ÿå‡çº§ä¸ºvue-router@4.xç‰ˆæœ¬  
>
> vue-router4çš„è¯­æ³•å’Œ3çš„ç‰ˆæœ¬è¯­æ³•åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç»†å¾®çš„ä¿®æ”¹ã€‚

vue-routerå®˜ç½‘ï¼šhttps://router.vuejs.org/

## åŸºæœ¬ä½¿ç”¨

### å®‰è£…

```shell
yarn add vue-router
# æˆ–
npm install vue-router
```

ç°åœ¨é»˜è®¤å®‰è£… `vue-router@4` ï¼Œå¦‚æœéœ€è¦ç»ƒä¹ ä»¥å‰çš„ `Vue2`ï¼Œéœ€è¦å®‰è£… `vue-router@3`

### ä½¿ç”¨

(1)åˆ›å»ºç»„ä»¶ `Home.vue` å’Œ `Login.vue`

(2)åˆ›å»ºæ–‡ä»¶è·¯ç”±å…¥å£æ–‡ä»¶`router/index.ts`

```js
import {
  createRouter,
  createWebHashHistory,
  createWebHistory,
} from 'vue-router'

// åˆ›å»ºè·¯ç”±
const router = createRouter({
  // åˆ›å»ºhistoryæ¨¡å¼çš„è·¯ç”±
  // history: createWebHistory(),
  // åˆ›å»ºhashæ¨¡å¼çš„è·¯ç”±
  history: createWebHashHistory(),
  // é…ç½®è·¯ç”±è§„åˆ™
  routes: [
    { path: '/home', component: () => import('../views/Home.vue') },
    { path: '/login', component: () => import('../views/Login.vue') },
  ],
})

export default router

```

ï¼ˆ3ï¼‰åœ¨ `main.ts` ä¸­å¼•å…¥

```diff
import { createApp } from 'vue'
import App from './App.vue'
+import router from './router'

createApp(App)
+   .use(router)
    .mount('#app')
```

(4)App.vueä¸­ä½¿ç”¨

```vue
<script setup lang="ts">
// ğŸ‘åœ¨ TS é¡¹ç›®å¼€å‘ä¸­ï¼Œå¯ä»¥å¯¼å…¥è·¯ç”±ç»„ä»¶ç±»å‹ RouterLink å’Œ RouterView å¢å¼ºç±»å‹æ£€æŸ¥
// ä¸å¯¼å…¥çš„è¯ router-link å’Œ router-view ä¸º any (ç›¸å½“äºJSå¼€å‘)
import { RouterLink, RouterView } from 'vue-router'
</script>

<template>
  <h1>Vue-router@4</h1>
  <ul>
    <li>
      <router-link to="/home">é¦–é¡µ</router-link>
    </li>
    <li>
      <router-link to="/login">ç™»å½•</router-link>
    </li>
  </ul>

  <!-- è·¯ç”±å‡ºå£ -->
  <router-view />
</template>

```

## ç»„ä»¶ä¸­ä½¿ç”¨ route ä¸ router

> ç”±äºç»„ä»¶ä¸­æ— æ³•è®¿é—® this, å› ä¸ºæ— æ³•è®¿é—® this.$route ä¸ this.$router

ï¼ˆ1ï¼‰é€šè¿‡ `useRoute()` å¯ä»¥è·å– `route` è·¯ç”±ä¿¡æ¯

```vue
<script setup lang="ts">
import { useRoute } from 'vue-router'

// ç›¸å½“äº this.$route
const route = useRoute()
console.log(route)
console.log('åŸºæœ¬è·¯å¾„ä¿¡æ¯', route.path)
console.log('å®Œæ•´è·¯å¾„ä¿¡æ¯', route.fullPath)
</script>

<template>
  <h1>Home ä¸»é¡µ</h1>
</template>

```

ï¼ˆ2ï¼‰é€šè¿‡ `useRouter()` å¯ä»¥è·å– `router` è·¯ç”±å™¨ä¿¡æ¯

```vue
<script setup lang="ts">
import { useRouter } from 'vue-router'

// ç›¸å½“äº this.$router
const router = useRouter()
const loginBtn = () => {
  alert('ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°ä¸»é¡µ')
  router.push('/home')
}
</script>

<template>
  <h2>Login ç™»å½•é¡µ</h2>
  <button @click="loginBtn">ç™»å½•æŒ‰é’®</button>
  <button @click="router.push('/home')">ç›´æ¥è·³ä¸»é¡µ</button>
</template>

```

# çŠ¶æ€ç®¡ç† Pinia

![image-20220213181825857](docs/media/image-20220213181825857.png)

## åŸºæœ¬ä»‹ç»

> Pinia æ˜¯ Vue.js çš„è½»é‡çº§çŠ¶æ€ç®¡ç†åº“

å®˜æ–¹ç½‘ç«™ï¼šhttps://pinia.vuejs.org/

ä¸ºä»€ä¹ˆå­¦ä¹  Pinia?

+ piniaå’Œvuex4ä¸€æ ·ï¼Œä¹Ÿæ˜¯vueå®˜æ–¹çš„çŠ¶æ€ç®¡ç†å·¥å…·(ä½œè€…æ˜¯ VueX æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ï¼‰
+ piniaç›¸æ¯”vuex4ï¼ŒPinia å¯¹äº vue3 çš„å…¼å®¹æ€§æ›´å¥½
+ piniaç›¸æ¯”vuex4ï¼ŒPinia å…·å¤‡å®Œå–„çš„ TypeScript ç±»å‹æ¨è
+ pinia åŒæ ·æ”¯æŒ vue å¼€å‘è€…å·¥å…·, æœ€æ–°çš„å¼€å‘è€…å·¥å…·å¯¹vuex4æ”¯æŒä¸å¥½
+ **Pinia** çš„ API è®¾è®¡éå¸¸æ¥è¿‘ `Vuex 5` çš„[ææ¡ˆ](https://github.com/vuejs/rfcs/discussions/270)ã€‚

pinia æ ¸å¿ƒæ¦‚å¿µ

+ state: çŠ¶æ€
+ actions: ä¿®æ”¹çŠ¶æ€ï¼ˆåŒ…æ‹¬åŒæ­¥å’Œå¼‚æ­¥ï¼Œpinia ä¸­æ²¡æœ‰ mutationsï¼‰
+ getters: è®¡ç®—å±æ€§

## åŸºæœ¬ä½¿ç”¨ä¸state

> ç›®æ ‡ï¼šæŒæ¡piniaçš„ä½¿ç”¨æ­¥éª¤

ï¼ˆ1ï¼‰å®‰è£…

```shell
yarn add pinia
# æˆ–
npm install pinia
```

ï¼ˆ2ï¼‰åœ¨ `main.ts` ä¸­æŒ‚è½½ `pinia`

```diff
import { createApp } from 'vue'
import App from './App.vue'

+import { createPinia } from 'pinia'
+const pinia = createPinia()

createApp(App)
+  .use(pinia)
  .mount('#app')

```

ï¼ˆ3ï¼‰æ–°å»ºæ–‡ä»¶ `store/counter.ts`

```js
import { defineStore } from 'pinia'

// å®šä¹‰ Store, å‘½åå»ºè®®ï¼š useXxxxStore
// å‚æ•°1ï¼šStore çš„å”¯ä¸€æ ‡è¯†
// å‚æ•°2ï¼šé…ç½®å¯¹è±¡ï¼Œå¯ä»¥æä¾› state actions getters
const useCounterStore = defineStore('counter', {
  // ç›¸å½“äºç»„ä»¶ data
  state() {
    return {
      count: 0,
    }
  },
  // ç›¸å½“äºç»„ä»¶ computed
  getters: {},
  // ç›¸å½“äºç»„ä»¶ methods
  actions: {},
})

// å¯¼å‡º Store
export default useCounterStore

```

(4) åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```vue
<script setup lang="ts">
import useCounterStore from './store/counter'
// ä½¿ç”¨ Store
const counter = useCounterStore()
</script>

<template>
  <h1>è½»é‡çŠ¶æ€ç®¡ç†åº“ Pinia</h1>
  <h2>Storeï¼š{{ counter }}</h2>
  <h2>çŠ¶æ€ countï¼š{{ counter.count }}</h2>
</template>

```

## actionsçš„ä½¿ç”¨

> ç›®æ ‡ï¼šæŒæ¡piniaä¸­actionsçš„ä½¿ç”¨

åœ¨ piniaä¸­ æ²¡æœ‰mutationsï¼Œåªæœ‰ actionsï¼Œä¸ç®¡æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„ä»£ç ï¼Œéƒ½å¯ä»¥åœ¨actionsä¸­å®Œæˆã€‚

ï¼ˆ1ï¼‰åœ¨actionsä¸­æä¾›æ–¹æ³•å¹¶ä¸”ä¿®æ”¹æ•°æ®

```diff
import { defineStore } from 'pinia'
// 1. åˆ›å»ºstore
// å‚æ•°1ï¼šstoreçš„å”¯ä¸€è¡¨ç¤º
// å‚æ•°2ï¼šå¯¹è±¡ï¼Œå¯ä»¥æä¾›state actions getters
const useCounterStore = defineStore('counter', {
  state: () => {
    return {
      count: 0,
    }
  },
+  actions: {
+    add() {
+      this.count++
+    },
+    addAsync() {
+      setTimeout(() => {
+        this.count++
+      }, 1000)
+    },
+  },
})

export default useCounterStore
```

ï¼ˆ2ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```vue
<script setup>
import useCounterStore from './store/counter'

const counter = useCounterStore()
</script>

<template>
  <h1>æ ¹ç»„ä»¶---{{ counter.count }}</h1>
  <button @click="counter.add">åŠ 1</button>
  <button @click="counter.addAsync">å¼‚æ­¥åŠ 1</button>
</template>
```

## getters çš„ä½¿ç”¨

> pinia ä¸­çš„ getters å’Œ vuex ä¸­çš„åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå¸¦æœ‰ç¼“å­˜çš„åŠŸèƒ½

ï¼ˆ1ï¼‰åœ¨gettersä¸­æä¾›è®¡ç®—å±æ€§

```diff
import { defineStore } from 'pinia'
// 1. åˆ›å»ºstore
// å‚æ•°1ï¼šstoreçš„å”¯ä¸€è¡¨ç¤º
// å‚æ•°2ï¼šå¯¹è±¡ï¼Œå¯ä»¥æä¾› state actions getters
const useCounterStore = defineStore('counter', {
  state: () => {
    return {
      count: 0,
    }
  },
+  getters: {
+    double(): number {
+      return this.count * 2
+    },
+  },
  actions: {
    add() {
      this.count++
    },
    addAsync() {
      setTimeout(() => {
        this.count++
      }, 1000)
    },
  },
})

export default useCounterStore

```

(2)åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```vue
  <h1>æ ¹ç»„ä»¶---{{ counter.count }}</h1>
  <h3>{{ counter.double }}</h3>
```

## storeToRefs çš„ä½¿ç”¨

> ç›®æ ‡ï¼šæŒæ¡storeToRefsçš„ä½¿ç”¨

å¦‚æœç›´æ¥ä»piniaä¸­è§£æ„æ•°æ®ï¼Œä¼šä¸¢å¤±å“åº”å¼ï¼Œ ä½¿ç”¨storeToRefså¯ä»¥ä¿è¯è§£æ„å‡ºæ¥çš„æ•°æ®ä¹Ÿæ˜¯å“åº”å¼çš„

```vue
<script setup lang="ts">
import { storeToRefs } from 'pinia'
import useCounterStore from './store/counter'

const counter = useCounterStore()
// âŒ å¦‚æœç›´æ¥ä»piniaä¸­è§£æ„æ•°æ®ï¼Œä¼šä¸¢å¤±å“åº”å¼
// const { count, double } = counter

// âœ…ä½¿ç”¨ storeToRefs å¯ä»¥ä¿è¯è§£æ„å‡ºæ¥çš„æ•°æ®ä¹Ÿæ˜¯å“åº”å¼çš„
const { count, double } = storeToRefs(counter)
</script>

<template>
  <h1>è½»é‡çŠ¶æ€ç®¡ç†åº“ Pinia</h1>
  <h2>Storeï¼š{{ counter }}</h2>
  <h1>{{ count }}</h1>
  <h3>{{ double }}</h3>
  <hr />
  <button @click="counter.add">åŠ 1</button>
  <button @click="counter.addAsync">å¼‚æ­¥åŠ 1</button>
</template>
```

## pinia æ¨¡å—åŒ–

> åœ¨å¤æ‚é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½å§å¤šä¸ªæ¨¡å—çš„æ•°æ®éƒ½å®šä¹‰åˆ°ä¸€ä¸ªstoreä¸­ï¼Œä¸€èˆ¬æ¥è¯´ä¼šä¸€ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªstoreï¼Œæœ€åé€šè¿‡ä¸€ä¸ªæ ¹storeè¿›è¡Œæ•´åˆ

ï¼ˆ1ï¼‰æ–°å»º `store/user.ts` æ–‡ä»¶

```js
import { defineStore } from 'pinia'

const useUserStore = defineStore('user', {
  state: () => {
    return {
      name: 'zs',
      age: 18,
    }
  },
})

export default useUserStore
```

(2)æ–°å»º `store/index.ts`

```js
import useUserStore from './user'
import useCounterStore from './counter'

// ç»Ÿä¸€å¯¼å‡º useStore æ–¹æ³•
export default function useStore() {
  return {
    user: useUserStore(),
    counter: useCounterStore(),
  }
}

```

ï¼ˆ3ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```diff
<script setup lang="ts">
import { storeToRefs } from 'pinia'
-import useCounterStore from './store/counter'
-const counter = useCounterStore()

+import useStore from './store'
+const { counter } = useStore()

// ä½¿ç”¨storeToRefså¯ä»¥ä¿è¯è§£æ„å‡ºæ¥çš„æ•°æ®ä¹Ÿæ˜¯å“åº”å¼çš„
const { count, double } = storeToRefs(counter)
</script>
```





# Vue3 è°ƒè¯•å·¥å…·

VueDevtools 6.x ç‰ˆæœ¬åŒæ—¶æ”¯æŒ Vue3+Vue2ã€‚æŠŠä»¥å‰çš„æ—§ç‰ˆç¦ç”¨æ‰ã€‚



# ç»¼åˆæ¡ˆä¾‹-todomvc

## æ•°æ®åˆå§‹åŒ–

ï¼ˆ1ï¼‰ åœ¨ `main.ts` ä¸­å¼•å…¥ `pinia`

```js
import { createApp } from 'vue'
import App from './App.vue'
import { createPinia } from 'pinia'
import './styles/base.css'
import './styles/index.css'

const pinia = createPinia()
createApp(App).use(pinia).mount('#app')

```

(2)æ–°å»ºæ–‡ä»¶ `store/modules/todos.ts`

```js
import { defineStore } from 'pinia'

const useTodosStore = defineStore('todos', {
  // çŠ¶æ€
  state() {
    return {
      list: [
        { id: 1, content: 'åƒé¥­', done: true },
        { id: 2, content: 'ç¡è§‰', done: false },
        { id: 3, content: 'æ‰“ä»£ç ', done: false },
      ],
    }
  },
})

export default useTodosStore

```

(3)æ–°å»ºæ–‡ä»¶ `store/index.ts`

```js
import useTodosStore from './modules/todos'

export default function useStore() {
  return {
    todos: useTodosStore(),
  }
}

```

## åˆ—è¡¨å±•ç¤ºåŠŸèƒ½

(4)åœ¨ `src/components/TodoMain.vue` ä¸­æ¸²æŸ“

```vue
<script setup lang="ts">
import useStore from '../store'
const { todos } = useStore()
</script>

<template>
  <section class="main">
    <input id="toggle-all" class="toggle-all" type="checkbox" />
    <label for="toggle-all">Mark all as complete</label>
    <ul class="todo-list">
      <li
        :class="{ completed: item.done }"
        v-for="item in todos.list"
        :key="item.id"
      >
        <div class="view">
          <input class="toggle" type="checkbox" :checked="item.done" />
          <label>{{ item.content }}</label>
          <button class="destroy"></button>
        </div>
        <input class="edit" value="Create a TodoMVC template" />
      </li>
    </ul>
  </section>
</template>
```

## ä¿®æ”¹ä»»åŠ¡çŠ¶æ€

> ç›®æ ‡ï¼šå®Œæˆä»»åŠ¡ä¿®æ”¹çŠ¶æ€

(1)åœ¨ actions ä¸­æä¾›æ–¹æ³•

```js
actions: {
  changeDone(id: number) {
    const todo = this.list.find((item) => item.id === id)
    if(todo){
        todo.done = !todo.done
    }
  },
},
```

(2)åœ¨ç»„ä»¶ä¸­æ³¨å†Œäº‹ä»¶

```vue
<input
  class="toggle"
  type="checkbox"
  :checked="item.done"
  @change="todos.changeDone(item.id)"
/>
```

## åˆ é™¤ä»»åŠ¡

> ç›®æ ‡ï¼šå®Œæˆä»»åŠ¡åˆ é™¤åŠŸèƒ½

ï¼ˆ1ï¼‰åœ¨actionsä¸­æä¾›æ–¹æ³•

```js
actions: {
  delTodo(id: number) {
    this.list = this.list.filter((item) => item.id !== id)
  },
},
```

(2)åœ¨ç»„ä»¶ä¸­æ³¨å†Œäº‹ä»¶

```vue
<button class="destroy" @click="todos.delTodo(item.id)"></button>
```

## æ·»åŠ ä»»åŠ¡

> ç›®æ ‡ï¼šå®Œæˆä»»åŠ¡æ·»åŠ åŠŸèƒ½

ï¼ˆ1ï¼‰åœ¨actionsä¸­æä¾›æ–¹æ³•

```js
actions: {
  addTodo(content: string) {
    this.list.unshift({
      id: Date.now(),
      content: content,
      done: false,
    })
  },
},
```

(2)åœ¨ç»„ä»¶ä¸­æ³¨å†Œäº‹ä»¶

```vue
<script setup>
import { ref } from 'vue'
import useStore from '../store'
const { todos } = useStore()
const todoName = ref('')
const add = () => {
  if (todoName.value) {
    todos.addTodo(todoName.value)
    // æ¸…ç©º
    todoName.value = ''
  }
}
</script>

<template>
  <header class="header">
    <h1>todos</h1>
    <input
      class="new-todo"
      placeholder="What needs to be done?"
      autofocus
      v-model="todoName"
      @keydown.enter="add"
    />
  </header>
</template>
```

## è®¡ç®—å’Œä¿®æ”¹å…¨é€‰åŠŸèƒ½

> å®Œæˆtodosçš„å…¨é€‰å’Œåé€‰åŠŸèƒ½

ï¼ˆ1ï¼‰åœ¨gettersä¸­æä¾›è®¡ç®—å±æ€§ï¼Œåœ¨actionsä¸­æä¾›æ–¹æ³•

```js
const useTodosStore = defineStore('todos', {

  actions: {
    checkAll(value) {
      this.list.forEach((item) => (item.done = value))
    },
  },
  getters: {
    // æ˜¯å¦å…¨é€‰
    isCheckAll() {
      return this.list.every((item) => item.done)
    },
  },
})
```

ï¼ˆ2ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```js
<input
  id="toggle-all"
  class="toggle-all"
  type="checkbox"
  :checked="todos.isCheckAll"
  @change="todos.checkAll(!todos.isCheckAll)"
/>
```

## åº•éƒ¨ç»Ÿè®¡ä¸æ¸…ç©ºåŠŸèƒ½

> ç›®æ ‡ï¼šå®Œæˆåº•éƒ¨çš„ç»Ÿè®¡ä¸æ¸…ç©ºåŠŸèƒ½

ï¼ˆ1ï¼‰åœ¨gettersä¸­æä¾›è®¡ç®—å±æ€§

```js
const useTodosStore = defineStore('todos', {

  actions: {
    clearTodo() {
      this.list = this.list.filter((item) => !item.done)
    },
  },
  getters: {
    leftCount(): number {
      return this.list.length > 0 && this.list.filter((item) => !item.done).length
    },
  },
})

```

ï¼ˆ2ï¼‰åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```vue
<span class="todo-count">
  <strong>{{ todos.leftCount }}</strong> item left
</span>

<button class="clear-completed" @click="todos.clearTodo">
  Clear completed
</button>
```

## åº•éƒ¨ç­›é€‰åŠŸèƒ½

ï¼ˆ1ï¼‰æä¾›æ•°æ®

```js
state: () => ({
  filters: ['All', 'Active', 'Completed'],
  active: 'All',
}),
```

ï¼ˆ2ï¼‰æä¾›actions

```js
actions: {
  changeActive(active) {
    this.active = active
  },
},
```

ï¼ˆ3ï¼‰åœ¨footerä¸­æ¸²æŸ“

```vue
<ul class="filters">
  <li
    v-for="item in todos.filters"
    :key="item"
    @click="todos.changeActive(item)"
  >
    <a :class="{ selected: item === todos.active }" href="#/">{{ item }}</a>
  </li>
</ul>
```

(4)æä¾›è®¡ç®—å±æ€§

```js
showList() {
  if (this.active === 'Active') {
    return this.list.filter((item) => !item.done)
  } else if (this.active === 'Completed') {
    return this.list.filter((item) => item.done)
  } else {
    return this.list
  }
},
```

ï¼ˆ5ï¼‰ç»„ä»¶ä¸­æ¸²æŸ“

```vue
<ul class="todo-list">
  <li
    :class="{ completed: item.done }"
    v-for="item in todos.showList"
    :key="item.id"
  >
```



## æŒä¹…åŒ–å­˜å‚¨

ï¼ˆ1ï¼‰è®¢é˜… store ä¸­æ•°æ®çš„å˜åŒ–

```js
const { todos } = useStore()
todos.$subscribe(() => {
  localStorage.setItem('todos', JSON.stringify(todos.list))
})
```

ï¼ˆ2ï¼‰è·å–æ•°æ®æ—¶ä»æœ¬åœ°ç¼“å­˜ä¸­è·å–

```js
interface Todo {
  id: number
  content: string
  done: boolean
}

  // çŠ¶æ€
  state() {
    return {
      list: JSON.parse(localStorage.getItem('todos-list') || '[]') as Todo[],
    }
  },
```





